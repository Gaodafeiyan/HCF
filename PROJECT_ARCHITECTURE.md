# HCF DeFi 项目架构文档（修正版）

## 一、项目总体架构

### 核心代币
- **HCF Token**: 总供应量10亿，首发1000万（1%）
- **BSDT Token**: 1:1 USDT锚定稳定币
- **Node NFT**: 99个限量节点

### 合约体系（12核心合约）
1. **HCFToken.sol** - 主代币合约
2. **HCFStaking.sol** - 质押挖矿合约
3. **HCFReferral.sol** - 推荐系统合约
4. **HCFNodeNFT.sol** - 节点NFT合约
5. **HCFRanking.sol** - 排名系统合约
6. **HCFBSDTExchange.sol** - 兑换系统合约
7. **BSDTToken.sol** - BSDT稳定币合约
8. **USDTOracle.sol** - USDT价格预言机
9. **MultiSigWallet.sol** - 多签钱包合约
10. **HCFMarketControl.sol** - 市场控制合约
11. **HCFBurnMechanism.sol** - 燃烧机制合约
12. **HCFLPMining.sol** - LP挖矿合约

### 辅助合约
- **HCFKeeper.sol** - Chainlink自动化合约
- **HCFImpermanentLossProtection.sol** - 无常损失保护

## 二、代币经济模型

### HCF代币分配
- 总量：10亿 HCF
- 初始流通：1000万 HCF（1%）
- 储备金：900万 HCF（0.9%，多签控制）
- LP挖矿奖励：9.81亿 HCF（98.1%）
- 最小持有量：0.0001 HCF（账户必须保留）

### 销毁机制
- 自动销毁至99万供应量后停止
- 买入税：0.5%销毁
- 卖出税：2%销毁
- 转账税：1%纯销毁

## 三、质押系统

### 5级质押等级
1. **等级1**: 100 HCF，日化0.3%（月化8%），复投倍数1.0
2. **等级2**: 500 HCF，日化0.35%（月化10%），复投倍数1.1
3. **等级3**: 1,000 HCF，日化0.4%（月化12%），复投倍数1.2
4. **等级4**: 10,000 HCF，日化0.5%（月化15%），复投倍数1.5
5. **等级5**: 100,000 HCF，日化0.6%（月化18%），复投倍数2.0

### LP质押加成
- LP质押获得2倍收益
- 静态收益比例：50% + (LP中HCF数量/1000 × 50%)，最高100%
- 动态收益比例：与静态比例联动，50%-100%

## 四、推荐系统

### 20代推荐奖励
- 1代：30%
- 2代：20%
- 3代：15%
- 4代：10%
- 5代：8%
- 6代：5%
- 7-10代：3%
- 11-15代：1%
- 16-20代：0.5%

### 团队等级奖励（V1-V6）
- **V1**：6%（3个1代，团队100 HCF）
- **V2**：12%（2个V1，团队1,000 HCF）
- **V3**：18%（2个V2，团队10,000 HCF）
- **V4**：24%（2个V3，团队100,000 HCF）
- **V5**：30%（3个V4，团队1,000,000 HCF）
- **V6**：36%（3个V5，团队10,000,000 HCF）

### 平级奖励
- 同级团队获得10%额外奖励

## 五、节点系统

### 99限量节点NFT
- **总量**：99个
- **分层**：
  - 青铜节点：33个，算力1,000
  - 白银节点：33个，算力3,000
  - 黄金节点：33个，算力10,000
- **激活要求**：必须质押对应HCF才能激活
- **算力奖励**：根据算力占比分配额外收益
- **转让限制**：激活后30天内不可转让

## 六、防砸盘机制

### 价格跌幅响应
- **10%跌幅**：
  - 额外5%滑点税
  - 减产5%
  - 3%自动销毁
- **30%跌幅**：
  - 额外15%滑点税
  - 减产15%
  - 10%自动销毁
- **50%跌幅**：
  - 额外30%滑点税
  - 减产30%
  - 20%自动销毁

### 900万HCF调控池
- 多签钱包控制（3/5签名）
- 用于市场稳定干预
- 防止恶意砸盘

## 七、BSDT桥接系统

### BSDT特性
- 1:1锚定USDT
- 仅可在指定DEX交易
- 防止价格操纵
- 通过Oracle维护价格稳定

### 兑换机制
- USDT→HCF：无滑点，0.3%手续费
- HCF→USDT：根据流动池深度计算滑点
- BSDT→USDT：1:1兑换
- 大额兑换需要多签批准

## 八、税收系统

### 买入税（2%）
- 0.5%销毁
- 0.5%营销
- 0.5%LP奖励
- 0.5%节点奖励

### 卖出税（5%）
- 2%销毁
- 1%营销
- 1%LP奖励
- 1%节点奖励

### 转账税（1%）
- 100%销毁

## 九、安全机制

### 多签钱包（3/5）
- 控制900万储备金
- 管理重要参数调整
- 执行紧急操作

### 时间锁
- 重要操作48小时延迟
- 防止恶意操作
- 提供社区反应时间

### 防护措施
- 闪电贷防护
- 三明治攻击防护
- 重入攻击防护
- 紧急暂停功能

## 十、自动化系统（Chainlink Keeper）

### 自动化任务
- 每日自动复投
- 定时奖励分发
- 每小时排名更新
- 实时价格同步
- 异常交易检测

## 十一、监控和预警

### 价格监控
- 10%跌幅：一级警报
- 30%跌幅：二级警报
- 50%跌幅：三级警报

### 交易监控
- 大额交易预警
- 异常频率检测
- 可疑地址标记

### 系统监控
- 合约状态检查
- Gas费用监控
- 流动性监控

## 十二、API桥接层

### Ethers.js事件监听（EventBridge）
- WebSocket连接BSC节点
- 实时监听所有合约事件
- 数据存储到MongoDB
- 推送到Redis缓存
- 触发WebSocket广播

### Web3.js钱包集成
- Web3Modal多钱包支持
- MetaMask/Trust Wallet/BSC Wallet
- 自动网络切换
- 交易状态追踪

### MongoDB Change Streams
- 实时排名更新
- 用户数据变更推送
- 历史数据聚合
- 性能指标计算

### GraphQL订阅
- 价格更新订阅
- 排名变化订阅
- 用户质押更新
- 奖励分发通知

## 十三、技术架构

### 前端技术栈
- Next.js 13+ (App Router)
- React 18
- TypeScript
- TailwindCSS
- Ethers.js/Web3.js

### 后端技术栈
- Node.js + Express
- GraphQL + Apollo
- MongoDB + Redis
- WebSocket (Socket.io)
- Bull Queue

### 智能合约
- Solidity 0.8.20
- OpenZeppelin 5.0
- Hardhat Framework
- Chainlink Services

### 部署架构
- BSC主网部署
- IPFS前端托管
- AWS/Cloudflare CDN
- MongoDB Atlas
- Redis Cloud

## 十四、开发路线图

### Phase 1 - 基础功能（已完成）
- ✅ 核心合约开发
- ✅ 5级质押系统
- ✅ 推荐奖励系统
- ✅ BSDT桥接

### Phase 2 - 高级功能（进行中）
- ✅ 99节点NFT系统
- ✅ 防砸盘机制
- ✅ 多签钱包
- ✅ API桥接层

### Phase 3 - 优化升级（计划中）
- ⏳ Gas优化
- ⏳ 跨链桥接
- ⏳ DAO治理
- ⏳ 移动端DApp

## 十五、审计和安全

### 安全审计
- 代码审计（进行中）
- 渗透测试（计划中）
- 经济模型审计（计划中）

### 风险管理
- 流动性风险：900万调控池
- 价格风险：防砸盘机制
- 技术风险：多重安全防护
- 操作风险：多签+时间锁

---

**最后更新时间**: 2024-12-27
**版本**: v2.0（修正版）